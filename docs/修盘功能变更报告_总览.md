# 修盘数据接入（grid）变更报告（总览）

## 1. 交付目标

1) 从数据库读取“修盘”数据（`grid` 表）并在界面展示；  
2) 支持按设备/修盘方式/日期范围筛选；  
3) 在修盘页触发“修盘后质量变化”分析图表（按修盘后的第 N 盘/批次）。

## 2. 数据来源

- SQL 备份：`数据库备份\\江西\\olam_demo_250411.sql`
- 表：`public.grid`
- 关键字段：`id/device_id/grid_mod/set_round/start_time/end_time/round_num/end_way`

## 3. 改动清单

### 3.1 后端（olam_api_server）

- 新增修盘记录查询接口：`GET /api/grid`
  - 参数：`deviceId/gridMod(startDate,endDate)/limit/offset`（兼容 `repairMethod`）
  - 返回：包含 `duration_seconds`（后端计算时长，秒）
- 新增修盘下拉选项接口：`GET /api/grid/options`（提供 `grid_mod/end_way` 去重列表）
- 增强分析接口：`GET /api/analysis/repair-effect`
  - 由“24h 窗口”改为“按修盘后的第 N 盘/批次（直到下一次修盘为止）”
  - 新增参数 `maxBatches`（默认 30）

### 3.2 前端/桌面端（oalm_desktop_app）

- 左侧菜单新增入口“修盘数据”，路由 `/grid`
- 修盘页包含：筛选 + grid 记录表格 + 修盘后质量变化图表（按盘数）

## 4. 客户研发二次开发指引（最短路径）

- 增加字段：后端 `/api/grid` `SELECT` 加列 + 前端表格加 `el-table-column`
- 增加筛选：后端 `conditions/params` 加条件 + 前端 `filterForm/fetchGrid()` 传参
- 做分页：后端已有 `limit/offset`，前端加分页控件即可

